@{
    ViewData["Title"] = "Home Page";
    var employee = ViewBag.Employee as OKRPerformanceManagement.Models.Employee;
    var userRole = ViewBag.UserRole as string;
}

<div class="text-center">
    <h1 class="display-4">Welcome to OKR Performance Management</h1>
    <p class="lead">Track and manage employee performance with Objectives and Key Results (OKRs)</p>
    
    @if (employee != null)
    {
        <div class="alert alert-info mt-3">
            <h4>Welcome, @employee.FirstName @employee.LastName!</h4>
            <p><strong>Role:</strong> @employee.Role | <strong>Position:</strong> @employee.Position</p>
            <p><strong>Line of Business:</strong> @employee.LineOfBusiness | <strong>Financial Year:</strong> @employee.FinancialYear</p>
        </div>
    }
</div>

<!-- Upcoming Scheduled Discussions Banner -->
@if (ViewBag.UpcomingDiscussions != null && ((List<OKRPerformanceManagement.Models.PerformanceReview>)ViewBag.UpcomingDiscussions).Any())
{
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow border-left-warning">
                <div class="card-header py-3 bg-warning text-white">
                    <h6 class="m-0 font-weight-bold">
                        <i class="fas fa-calendar-check me-2"></i>Upcoming Discussion Sessions
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        @foreach (var discussion in ((List<OKRPerformanceManagement.Models.PerformanceReview>)ViewBag.UpcomingDiscussions))
                        {
                            <div class="col-md-6 mb-3">
                                <div class="card border-left-info h-100">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-start">
                                            <div>
                                                @if (userRole == "Manager")
                                                {
                                                    <h6 class="font-weight-bold text-primary mb-2">
                                                        <i class="fas fa-user me-2"></i>@discussion.Employee.FirstName @discussion.Employee.LastName
                                                    </h6>
                                                }
                                                else
                                                {
                                                    <h6 class="font-weight-bold text-primary mb-2">
                                                        <i class="fas fa-user-tie me-2"></i>With: @discussion.Manager.FirstName @discussion.Manager.LastName
                                                    </h6>
                                                }
                                                <p class="mb-1">
                                                    <i class="fas fa-calendar-alt me-2 text-info"></i>
                                                    <strong>Date:</strong> @discussion.ScheduledDiscussionDate.Value.ToString("MMMM dd, yyyy")
                                                </p>
                                                <p class="mb-1">
                                                    <i class="fas fa-clock me-2 text-info"></i>
                                                    <strong>Time:</strong> @discussion.ScheduledDiscussionDate.Value.ToString("hh:mm tt")
                                                </p>
                                                <p class="mb-0 text-muted small">
                                                    <i class="fas fa-file-alt me-2"></i>
                                                    Review Period: @discussion.ReviewPeriodStart.ToString("MMM dd") - @discussion.ReviewPeriodEnd.ToString("MMM dd, yyyy")
                                                </p>
                                            </div>
                                            <div>
                                                @if (userRole == "Manager")
                                                {
                                                    <a href="@Url.Action("ReviewDetails", "Manager", new { id = discussion.Id })" class="btn btn-sm btn-info">
                                                        <i class="fas fa-eye"></i> View Review
                                                    </a>
                                                }
                                                else
                                                {
                                                    <a href="@Url.Action("ReviewDetails", "Employee", new { id = discussion.Id })" class="btn btn-sm btn-info">
                                                        <i class="fas fa-eye"></i> View Review
                                                    </a>
                                                }
                                            </div>
                                        </div>
                                        @{
                                            var daysUntil = (discussion.ScheduledDiscussionDate.Value.Date - DateTime.Today).Days;
                                        }
                                        @if (daysUntil == 0)
                                        {
                                            <div class="alert alert-warning mt-2 mb-0 py-1">
                                                <i class="fas fa-exclamation-triangle me-1"></i><strong>Today!</strong>
                                            </div>
                                        }
                                        else if (daysUntil == 1)
                                        {
                                            <div class="alert alert-info mt-2 mb-0 py-1">
                                                <i class="fas fa-info-circle me-1"></i><strong>Tomorrow</strong>
                                            </div>
                                        }
                                        else
                                        {
                                            <div class="text-muted mt-2 small">
                                                <i class="fas fa-hourglass-half me-1"></i>@daysUntil days remaining
                                            </div>
                                        }
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
}

@if (userRole == "HR")
{
    <div class="row mt-5">
        <div class="col-md-3">
            <div class="card text-white bg-primary mb-3">
                <div class="card-header">Total Employees</div>
                <div class="card-body">
                    <h4 class="card-title">@ViewBag.EmployeeCount</h4>
                    <p class="card-text">All employees in the system</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-warning mb-3">
                <div class="card-header">Active Reviews</div>
                <div class="card-body">
                    <h4 class="card-title">@ViewBag.ActiveReviews</h4>
                    <p class="card-text">Reviews in progress</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-success mb-3">
                <div class="card-header">Completed Reviews</div>
                <div class="card-body">
                    <h4 class="card-title">@ViewBag.CompletedReviews</h4>
                    <p class="card-text">Reviews completed</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-info mb-3">
                <div class="card-header">Total Reviews</div>
                <div class="card-body">
                    <h4 class="card-title">@ViewBag.ReviewCount</h4>
                    <p class="card-text">All performance reviews</p>
                </div>
            </div>
        </div>
    </div>
}
else if (userRole == "Admin")
{
    <div class="row mt-5">
        <div class="col-md-3">
            <div class="card text-white bg-primary mb-3">
                <div class="card-header">Total Employees</div>
                <div class="card-body">
                    <h4 class="card-title">@ViewBag.EmployeeCount</h4>
                    <p class="card-text">All employees in the system</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-success mb-3">
                <div class="card-header">Active Reviews</div>
                <div class="card-body">
                    <h4 class="card-title">@ViewBag.ActiveReviews</h4>
                    <p class="card-text">Reviews in progress</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-info mb-3">
                <div class="card-header">Managers</div>
                <div class="card-body">
                    <h4 class="card-title">@ViewBag.ManagerCount</h4>
                    <p class="card-text">Total managers</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-warning mb-3">
                <div class="card-header">Completed Reviews</div>
                <div class="card-body">
                    <h4 class="card-title">@ViewBag.CompletedReviews</h4>
                    <p class="card-text">Reviews completed</p>
                </div>
            </div>
        </div>
    </div>
}
else if (userRole == "Manager")
{
    <div class="row mt-5">
        <div class="col-md-3">
            <div class="card text-white bg-primary mb-3">
                <div class="card-header">My Team Members</div>
                <div class="card-body">
                    <h4 class="card-title">@ViewBag.EmployeeCount</h4>
                    <p class="card-text">Team members under my management</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-warning mb-3">
                <div class="card-header">Pending Reviews</div>
                <div class="card-body">
                    <h4 class="card-title">@ViewBag.PendingReviews</h4>
                    <p class="card-text">Reviews awaiting my action</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-success mb-3">
                <div class="card-header">Completed Reviews</div>
                <div class="card-body">
                    <h4 class="card-title">@ViewBag.CompletedReviews</h4>
                    <p class="card-text">Reviews completed this period</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-info mb-3">
                <div class="card-header">Team Objectives</div>
                <div class="card-body">
                    <h4 class="card-title">@ViewBag.ObjectiveCount</h4>
                    <p class="card-text">Objectives set for my team</p>
                </div>
            </div>
        </div>
    </div>
    
}
else
{
    <div class="row mt-5">
        <div class="col-md-3">
            <div class="card text-white bg-primary mb-3">
                <div class="card-header">My Reviews</div>
                <div class="card-body">
                    <h4 class="card-title">@ViewBag.ReviewCount</h4>
                    <p class="card-text">My performance reviews</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-info mb-3">
                <div class="card-header">My Objectives</div>
                <div class="card-body">
                    <h4 class="card-title">@ViewBag.ObjectiveCount</h4>
                    <p class="card-text">Objectives assigned to me</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-warning mb-3">
                <div class="card-header">My Key Results</div>
                <div class="card-body">
                    <h4 class="card-title">@ViewBag.KeyResultCount</h4>
                    <p class="card-text">Key results to achieve</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-success mb-3">
                <div class="card-header">Active Reviews</div>
                <div class="card-body">
                    <h4 class="card-title">@(ViewBag.MyActiveReviews?.Count ?? 0)</h4>
                    <p class="card-text">Reviews in progress</p>
                </div>
            </div>
        </div>
    </div>
}

<div class="row mt-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5>Quick Actions</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    @if (userRole == "HR")
                    {
                        <div class="col-md-3">
                            <a href="@Url.Action("Index", "HR")" class="btn btn-primary btn-lg btn-block mb-2">HR Dashboard</a>
                        </div>
                        <div class="col-md-3">
                            <a href="@Url.Action("AssignOKR", "HR")" class="btn btn-success btn-lg btn-block mb-2">Assign OKR to Anyone</a>
                        </div>
                        <div class="col-md-3">
                            <a href="@Url.Action("CreateEmployee", "HR")" class="btn btn-info btn-lg btn-block mb-2">Add User</a>
                        </div>
                        <div class="col-md-3">
                            <a href="@Url.Action("ViewAllReviews", "HR")" class="btn btn-warning btn-lg btn-block mb-2">View All Reviews</a>
                        </div>
                    }
                    else if (userRole == "Manager")
                    {
                        <div class="col-md-3">
                            <a href="@Url.Action("Index", "Manager")" class="btn btn-primary btn-lg btn-block mb-2">Manager Dashboard</a>
                        </div>
                        <div class="col-md-3">
                            <a href="@Url.Action("CreateTemplateReview", "Manager")" class="btn btn-success btn-lg btn-block mb-2">Create Template Review</a>
                        </div>
                        <div class="col-md-3">
                            <a href="@Url.Action("PendingReviews", "Manager")" class="btn btn-info btn-lg btn-block mb-2">Pending Reviews</a>
                        </div>
                        <div class="col-md-3">
                            <a href="@Url.Action("CreateEmployee", "Manager")" class="btn btn-warning btn-lg btn-block mb-2">Create Employee</a>
                        </div>
                    }
                    else if (userRole == "Admin")
                    {
                        <div class="col-md-3">
                            <a href="@Url.Action("Index", "Admin")" class="btn btn-primary btn-lg btn-block mb-2">Admin Dashboard</a>
                        </div>
                        <div class="col-md-3">
                            <a href="@Url.Action("CreateEmployee", "Admin")" class="btn btn-success btn-lg btn-block mb-2">Create Employee</a>
                        </div>
                        <div class="col-md-3">
                            <a href="@Url.Action("Index", "Admin")" class="btn btn-info btn-lg btn-block mb-2">Manage Roles</a>
                        </div>
                        <div class="col-md-3">
                            <a href="@Url.Action("Index", "Admin")" class="btn btn-warning btn-lg btn-block mb-2">My Reviews</a>
                        </div>
                    }
                    else
                    {
                        <div class="col-md-4">
                            <a href="@Url.Action("MyActiveReviews", "Employee")" class="btn btn-success btn-lg btn-block mb-2">My Active Reviews</a>
                        </div>
                        <div class="col-md-4">
                            <a href="@Url.Action("MyPerformanceHistory", "Employee")" class="btn btn-primary btn-lg btn-block mb-2">My Performance Reviews</a>
                        </div>
                        <div class="col-md-4">
                            <a href="@Url.Action("MyOKRs", "Employee")" class="btn btn-info btn-lg btn-block mb-2">View Current OKRs</a>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .avatar-sm {
        width: 40px;
        height: 40px;
        font-size: 14px;
        font-weight: bold;
    }
    
    .border-left-primary {
        border-left: 4px solid #007bff !important;
    }
    
    .border-left-success {
        border-left: 4px solid #28a745 !important;
    }
    
    .border-left-warning {
        border-left: 4px solid #ffc107 !important;
    }
    
    .border-left-info {
        border-left: 4px solid #17a2b8 !important;
    }
</style>

